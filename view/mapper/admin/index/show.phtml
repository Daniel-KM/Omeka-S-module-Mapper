<?php
/**
 * @var \Laminas\View\Renderer\PhpRenderer $this
 * @var bool $isDbMapping
 * @var \Mapper\Api\Representation\MapperRepresentation|null $mapping
 * @var \Mapper\Api\Representation\MapperRepresentation|null $resource
 * @var string $label
 * @var string $content
 */

$plugins = $this->getHelperPluginManager();
$url = $plugins->get('url');
$escape = $plugins->get('escapeHtml');
$assetUrl = $plugins->get('assetUrl');
$translate = $plugins->get('translate');
$hyperlink = $plugins->get('hyperlink');

$this->headLink()
    ->appendStylesheet($assetUrl('vendor/codemirror/lib/codemirror.css', 'Mapper'))
    ->appendStylesheet($assetUrl('vendor/codemirror/addon/hint/show-hint.css', 'Mapper'))
    ->appendStylesheet($assetUrl('css/mapper.css', 'Mapper'));
$this->headScript()
    ->appendFile($assetUrl('vendor/codemirror/lib/codemirror.js', 'Mapper'))
    ->appendFile($assetUrl('vendor/codemirror/addon/display/placeholder.js', 'Mapper'))
    ->appendFile($assetUrl('vendor/codemirror/addon/hint/show-hint.js', 'Mapper'))
    ->appendFile($assetUrl('vendor/codemirror/addon/hint/xml-hint.js', 'Mapper'))
    ->appendFile($assetUrl('vendor/codemirror/mode/xml/xml.js', 'Mapper'))
    ->appendFile($assetUrl('js/mapper.js', 'Mapper'));

$this->htmlElement('body')->appendAttribute('class', 'mapper show');
?>

<?= $this->pageTitle($translate('Show mapping'), 1, $translate('Mapper')) ?>

<div id="page-actions">
    <?php if ($this->userIsAllowed(\Mapper\Api\Adapter\MapperAdapter::class, 'create')): ?>
    <?php if (is_object($mapping) && $mapping->userIsAllowed('update')): ?>
    <?= $hyperlink($translate('Edit'), $url(null, ['action' => 'edit'], true), ['class' => 'button']) ?>
    <?php endif; ?>
    <?= $hyperlink($translate('Copy'), $url(null, ['action' => 'copy'], ['query' => $this->params()->fromQuery()], true), ['class' => 'button']) ?>
    <?php endif; ?>
</div>

<div id="mapper">
    <h2 class="label"><?= $escape($label) ?></h2>
    <pre class="mapping-content" style="background: #f5f5f5; padding: 1em; overflow-x: auto; border: 1px solid #ddd; font-family: monospace; white-space: pre-wrap;"><?= $escape($content) ?></pre>
</div>
